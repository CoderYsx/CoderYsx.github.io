

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="https://pic.downk.cc/item/5ff67d1e3ffa7d37b3ddf825.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  <title>JWT实战 - Ysx&#39;Blog</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css" />
    
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_pf9vaxs7x7b.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Ysx's Blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container page-header text-center fade-in-up">
            <span class="h2" id="subtitle">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-01-07 15:03" pubdate>
        2021年1月7日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      3.8k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      51
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" id="post">
            <!-- SEO header -->
            <h1 style="display: none">JWT实战</h1>
            
            <div class="markdown-body" id="post-body">
              <h1 id="JWT-实战"><a href="#JWT-实战" class="headerlink" title="JWT 实战"></a>JWT 实战</h1><p><img src="https://pic.downk.cc/item/5ff6b0473ffa7d37b3175f5f.png" srcset="/img/loading.gif" alt="image-20200726102546868"></p>
<h2 id="1-什么是JWT"><a href="#1-什么是JWT" class="headerlink" title="1.什么是JWT"></a>1.什么是JWT</h2><p>JSON Web Token (JWT) is an open standard (<a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7519">RFC 7519</a>) that defines a compact and self-contained way for securely transmitting information between parties as a JSON object. This information can be verified and trusted because it is digitally signed. JWTs can be signed using a secret (with the <strong>HMAC</strong> algorithm) or a public/private key pair using <strong>RSA</strong> or <strong>ECDSA</strong>.</p>
<p>​                                                                                                                                                                                                                                            —[摘自官网]</p>
<pre><code class="hljs markdown"><span class="hljs-section"># 1.翻译</span>
<span class="hljs-bullet">-</span>  官网地址: https://jwt.io/introduction/
<span class="hljs-bullet">-</span>  翻译: jsonwebtoken（JWT）是一个开放标准（rfc7519），它定义了一种紧凑的、自包含的方式，用于在各方之间以JSON对象安全地传输信息。此信息可以验证和信任，因为它是数字签名的。jwt可以使用秘密（使用HMAC算法）或使用RSA或ECDSA的公钥/私钥对进行签名

<span class="hljs-section"># 2.通俗解释</span>
<span class="hljs-bullet">-</span> JWT简称JSON Web Token,也就是通过JSON形式作为Web应用中的令牌,用于在各方之间安全地将信息作为JSON对象传输。在数据传输过程中还可以完成数据加密、签名等相关处理。</code></pre>

<h2 id="2-JWT能做什么"><a href="#2-JWT能做什么" class="headerlink" title="2.JWT能做什么"></a>2.JWT能做什么</h2><pre><code class="hljs markdown"><span class="hljs-section"># 1.授权</span>
<span class="hljs-bullet">-</span> 这是使用JWT的最常见方案。一旦用户登录，每个后续请求将包括JWT，从而允许用户访问该令牌允许的路由，服务和资源。单点登录是当今广泛使用JWT的一项功能，因为它的开销很小并且可以在不同的域中轻松使用。

<span class="hljs-section"># 2.信息交换</span>
<span class="hljs-bullet">-</span> JSON Web Token是在各方之间安全地传输信息的好方法。因为可以对JWT进行签名（例如，使用公钥/私钥对），所以您可以确保发件人是他们所说的人。此外，由于签名是使用标头和有效负载计算的，因此您还可以验证内容是否遭到篡改。</code></pre>

<h2 id="3-为什么是JWT"><a href="#3-为什么是JWT" class="headerlink" title="3.为什么是JWT"></a>3.为什么是JWT</h2><h3 id="基于传统的Session认证"><a href="#基于传统的Session认证" class="headerlink" title="基于传统的Session认证"></a>基于传统的Session认证</h3><pre><code class="hljs markdown"><span class="hljs-section"># 1.认证方式</span>
<span class="hljs-bullet">-</span> 我们知道，http协议本身是一种无状态的协议，而这就意味着如果用户向我们的应用提供了用户名和密码来进行用户认证，那么下一次请求时，用户还要再一次进行用户认证才行，因为根据http协议，我们并不能知道是哪个用户发出的请求，所以为了让我们的应用能识别是哪个用户发出的请求，我们只能在服务器存储一份用户登录的信息，这份登录信息会在响应时传递给浏览器，告诉其保存为cookie,以便下次请求时发送给我们的应用，这样我们的应用就能识别请求来自哪个用户了,这就是传统的基于session认证。
t
<span class="hljs-section"># 2.认证流程</span></code></pre>

<p><img src="https://pic.downk.cc/item/5ff6b0473ffa7d37b3175f61.png" srcset="/img/loading.gif" alt="image-20200726103959013"></p>
<pre><code class="hljs markdown"><span class="hljs-section"># 3.暴露问题</span>
<span class="hljs-bullet">-</span> 1.每个用户经过我们的应用认证之后，我们的应用都要在服务端做一次记录，以方便用户下次请求的鉴别，通常而言session都是保存在内存中，而随着认证用户的增多，服务端的开销会明显增大

<span class="hljs-bullet">-</span> 2.用户认证之后，服务端做认证记录，如果认证的记录被保存在内存中的话，这意味着用户下次请求还必须要请求在这台服务器上,这样才能拿到授权的资源，这样在分布式的应用上，相应的限制了负载均衡器的能力。这也意味着限制了应用的扩展能力。

<span class="hljs-bullet">-</span> 3.因为是基于cookie来进行用户识别的, cookie如果被截获，用户就会很容易受到跨站请求伪造的攻击。

<span class="hljs-bullet">-</span> 4.在前后端分离系统中就更加痛苦:如下图所示
<span class="hljs-code">	也就是说前后端分离在应用解耦后增加了部署的复杂性。通常用户一次请求就要转发多次。如果用session 每次携带sessionid 到服务	器，服务器还要查询用户信息。同时如果用户很多。这些信息存储在服务器内存中，给服务器增加负担。还有就是CSRF（跨站伪造请求攻	击）攻击，session是基于cookie进行用户识别的, cookie如果被截获，用户就会很容易受到跨站请求伪造的攻击。还有就是	     sessionid就是一个特征值，表达的信息不够丰富。不容易扩展。而且如果你后端应用是多节点部署。那么就需要实现session共享机制。	不方便集群应用。</span></code></pre>

<p>![image-20200804212240422](../../../../微服务/编程不良人/JWT实战教程资料/笔记/1/JWT 实战教程.assets/49.png)</p>
<h3 id="基于JWT认证"><a href="#基于JWT认证" class="headerlink" title="基于JWT认证"></a>基于JWT认证</h3><p><img src="https://pic.downk.cc/item/5ff6b0473ffa7d37b3175f6e.png" srcset="/img/loading.gif" alt="image-20200726183248298"></p>
<pre><code class="hljs markdown"><span class="hljs-section"># 1.认证流程</span>
<span class="hljs-bullet">-</span> 首先，前端通过Web表单将自己的用户名和密码发送到后端的接口。这一过程一般是一个HTTP POST请求。建议的方式是通过SSL加密的传输（https协议），从而避免敏感信息被嗅探。
<span class="hljs-bullet">-</span> 后端核对用户名和密码成功后，将用户的id等其他信息作为JWT Payload（负载），将其与头部分别进行Base64编码拼接后签名，形成一个JWT(Token)。形成的JWT就是一个形同lll.zzz.xxx的字符串。 token head.payload.singurater

<span class="hljs-bullet">-</span> 后端将JWT字符串作为登录成功的返回结果返回给前端。前端可以将返回的结果保存在localStorage或sessionStorage上，退出登录时前端删除保存的JWT即可。

<span class="hljs-bullet">-</span> 前端在每次请求时将JWT放入HTTP Header中的Authorization位。(解决XSS和XSRF问题) HEADER

<span class="hljs-bullet">-</span> 后端检查是否存在，如存在验证JWT的有效性。例如，检查签名是否正确；检查Token是否过期；检查Token的接收方是否是自己（可选）。
<span class="hljs-bullet">-</span> 验证通过后后端使用JWT中包含的用户信息进行其他逻辑操作，返回相应结果。

<span class="hljs-section"># 2.jwt优势</span>

<span class="hljs-bullet">-</span> 简洁(Compact): 可以通过URL，POST参数或者在HTTP header发送，因为数据量小，传输速度也很快

<span class="hljs-bullet">-</span> 自包含(Self-contained)：负载中包含了所有用户所需要的信息，避免了多次查询数据库

<span class="hljs-bullet">-</span> 因为Token是以JSON加密的形式保存在客户端的，所以JWT是跨语言的，原则上任何web形式都支持。

<span class="hljs-bullet">-</span> 不需要在服务端保存会话信息，特别适用于分布式微服务。</code></pre>

<h2 id="4-JWT的结构是什么"><a href="#4-JWT的结构是什么" class="headerlink" title="4.JWT的结构是什么?"></a>4.JWT的结构是什么?</h2><pre><code class="hljs markdown">token   string  ====&gt;  header.payload.singnature   token   

<span class="hljs-section"># 1.令牌组成</span>
<span class="hljs-bullet">-</span> 1.标头(Header)
<span class="hljs-bullet">-</span> 2.有效载荷(Payload)
<span class="hljs-bullet">-</span> 3.签名(Signature)
<span class="hljs-bullet">-</span> 因此，JWT通常如下所示:xxxxx.yyyyy.zzzzz   Header.Payload.Signature</code></pre>

<pre><code class="hljs markdown"><span class="hljs-section"># 2.Header</span>
<span class="hljs-bullet">-</span> 标头通常由两部分组成：令牌的类型（即JWT）和所使用的签名算法，例如HMAC SHA256或RSA。它会使用 Base64 编码组成 JWT 结构的第一部分。

<span class="hljs-bullet">-</span> 注意:Base64是一种编码，也就是说，它是可以被翻译回原来的样子来的。它并不是一种加密过程。</code></pre>

<pre><code class="hljs json">&#123;
  <span class="hljs-attr">&quot;alg&quot;</span>: <span class="hljs-string">&quot;HS256&quot;</span>,
  <span class="hljs-attr">&quot;typ&quot;</span>: <span class="hljs-string">&quot;JWT&quot;</span>
&#125;</code></pre>

<pre><code class="hljs markdown"><span class="hljs-section"># 3.Payload</span>
<span class="hljs-bullet">-</span> 令牌的第二部分是有效负载，其中包含声明。声明是有关实体（通常是用户）和其他数据的声明。同样的，它会使用 Base64 编码组成 JWT 结构的第二部分</code></pre>

<pre><code class="hljs json">&#123;
  <span class="hljs-attr">&quot;sub&quot;</span>: <span class="hljs-string">&quot;1234567890&quot;</span>,
  <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;John Doe&quot;</span>,
  <span class="hljs-attr">&quot;admin&quot;</span>: <span class="hljs-literal">true</span>
&#125;</code></pre>

<pre><code class="hljs markdown"><span class="hljs-section"># 4.Signature</span>
<span class="hljs-bullet">-</span> 前面两部分都是使用 Base64 进行编码的，即前端可以解开知道里面的信息。Signature 需要使用编码后的 header 和 payload 以及我们提供的一个密钥，然后使用 header 中指定的签名算法（HS256）进行签名。签名的作用是保证 JWT 没有被篡改过
<span class="hljs-bullet">-</span> 如:
<span class="hljs-code">	HMACSHA256(base64UrlEncode(header) + &quot;.&quot; + base64UrlEncode(payload),secret);</span>
<span class="hljs-code"></span>
<span class="hljs-code"># 签名目的</span>
<span class="hljs-code">- 最后一步签名的过程，实际上是对头部以及负载内容进行签名，防止内容被窜改。如果有人对头部以及负载的内容解码之后进行修改，再进行编码，最后加上之前的签名组合形成新的JWT的话，那么服务器端会判断出新的头部和负载形成的签名和JWT附带上的签名是不一样的。如果要对新的头部和负载进行签名，在不知道服务器加密时用的密钥的话，得出来的签名也是不一样的。</span>
<span class="hljs-code"></span>
<span class="hljs-code"># 信息安全问题</span>
<span class="hljs-code">- 在这里大家一定会问一个问题：Base64是一种编码，是可逆的，那么我的信息不就被暴露了吗？</span>
<span class="hljs-code"></span>
<span class="hljs-code">- 是的。所以，在JWT中，不应该在负载里面加入任何敏感的数据。在上面的例子中，我们传输的是用户的User ID。这个值实际上不是什么敏	感内容，一般情况下被知道也是安全的。但是像密码这样的内容就不能被放在JWT中了。如果将用户的密码放在了JWT中，那么怀有恶意的第	三方通过Base64解码就能很快地知道你的密码了。因此JWT适合用于向Web应用传递一些非敏感信息。JWT还经常用于设计用户认证和授权系	统，甚至实现Web应用的单点登录。</span></code></pre>

<p><img src="https://pic.downk.cc/item/5ff6b0473ffa7d37b3175f69.png" srcset="/img/loading.gif" alt="image-20200726181136113"></p>
<pre><code class="hljs markdown"><span class="hljs-section"># 5.放在一起</span>
<span class="hljs-bullet">-</span> 输出是三个由点分隔的Base64-URL字符串，可以在HTML和HTTP环境中轻松传递这些字符串，与基于XML的标准（例如SAML）相比，它更紧凑。
<span class="hljs-bullet">-</span> 简洁(Compact)
<span class="hljs-code">	可以通过URL, POST 参数或者在 HTTP header 发送，因为数据量小，传输速度快</span>
<span class="hljs-code">- 自包含(Self-contained)</span>
<span class="hljs-code">	负载中包含了所有用户所需要的信息，避免了多次查询数据库</span></code></pre>

<p><img src="https://pic.downk.cc/item/5ff6b0473ffa7d37b3175f65.png" srcset="/img/loading.gif" alt="image-20200726124257203"></p>
<h2 id="5-使用JWT"><a href="#5-使用JWT" class="headerlink" title="5.使用JWT"></a>5.使用JWT</h2><pre><code class="hljs markdown"><span class="hljs-section"># 1.引入依赖</span></code></pre>

<pre><code class="hljs xml"><span class="hljs-comment">&lt;!--引入jwt--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.auth0<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>java-jwt<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>

<pre><code class="hljs markdown"><span class="hljs-section"># 2.生成token</span></code></pre>

<pre><code class="hljs java">Calendar instance = Calendar.getInstance();
instance.add(Calendar.SECOND, <span class="hljs-number">90</span>);
<span class="hljs-comment">//生成令牌</span>
String token = JWT.create()
  .withClaim(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;张三&quot;</span>)<span class="hljs-comment">//设置自定义用户名</span>
  .withExpiresAt(instance.getTime())<span class="hljs-comment">//设置过期时间</span>
  .sign(Algorithm.HMAC256(<span class="hljs-string">&quot;token!Q2W#E$RW&quot;</span>));<span class="hljs-comment">//设置签名 保密 复杂</span>
<span class="hljs-comment">//输出令牌</span>
System.out.println(token);</code></pre>

<pre><code class="hljs markdown"><span class="hljs-bullet">-</span> 生成结果
eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdWQiOlsicGhvbmUiLCIxNDMyMzIzNDEzNCJdLCJleHAiOjE1OTU3Mzk0NDIsInVzZXJuYW1lIjoi5byg5LiJIn0.aHmE3RNqvAjFr<span class="hljs-emphasis">_dvyn_</span>sD2VJ46P7EGiS5OBMO<span class="hljs-emphasis">_TI5jg</span></code></pre>

<pre><code class="hljs markdown"><span class="hljs-section"># 3.根据令牌和签名解析数据</span></code></pre>

<pre><code class="hljs java">JWTVerifier jwtVerifier = JWT.require(Algorithm.HMAC256(<span class="hljs-string">&quot;token!Q2W#E$RW&quot;</span>)).build();
DecodedJWT decodedJWT = jwtVerifier.verify(token);
System.out.println(<span class="hljs-string">&quot;用户名: &quot;</span> + decodedJWT.getClaim(<span class="hljs-string">&quot;username&quot;</span>).asString());
System.out.println(<span class="hljs-string">&quot;过期时间: &quot;</span>+decodedJWT.getExpiresAt());</code></pre>

<pre><code class="hljs markdown"><span class="hljs-section"># 4.常见异常信息</span>
<span class="hljs-bullet">-</span> SignatureVerificationException:				签名不一致异常
<span class="hljs-bullet">-</span> TokenExpiredException:    						令牌过期异常
<span class="hljs-bullet">-</span> AlgorithmMismatchException:						算法不匹配异常
<span class="hljs-bullet">-</span> InvalidClaimException:								失效的payload异常</code></pre>

<p><img src="https://pic.downk.cc/item/5ff6b0473ffa7d37b3175f74.png" srcset="/img/loading.gif" alt="image-20200805184517282"></p>
<h2 id="6-封装工具类"><a href="#6-封装工具类" class="headerlink" title="6.封装工具类"></a>6.封装工具类</h2><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JWTUtils</span> </span>&#123;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String TOKEN = <span class="hljs-string">&quot;token!Q@W3e4r&quot;</span>;
    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 生成token</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> map  //传入payload</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 返回token</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">getToken</span><span class="hljs-params">(Map&lt;String,String&gt; map)</span></span>&#123;
        JWTCreator.Builder builder = JWT.create();
        map.forEach((k,v)-&gt;&#123;
            builder.withClaim(k,v);
        &#125;);
        Calendar instance = Calendar.getInstance();
        instance.add(Calendar.SECOND,<span class="hljs-number">7</span>);
        builder.withExpiresAt(instance.getTime());
        <span class="hljs-keyword">return</span> builder.sign(Algorithm.HMAC256(TOKEN)).toString();
    &#125;
    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 验证token</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> token</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">verify</span><span class="hljs-params">(String token)</span></span>&#123;
        JWT.require(Algorithm.HMAC256(TOKEN)).build().verify(token);
    &#125;
    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 获取token中payload</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> token</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DecodedJWT <span class="hljs-title">getToken</span><span class="hljs-params">(String token)</span></span>&#123;
        <span class="hljs-keyword">return</span> JWT.require(Algorithm.HMAC256(TOKEN)).build().verify(token);
    &#125;
&#125;</code></pre>

<h2 id="7-整合springboot"><a href="#7-整合springboot" class="headerlink" title="7.整合springboot"></a>7.整合springboot</h2><pre><code class="hljs markdown"><span class="hljs-section"># 0.搭建springboot+mybatis+jwt环境</span>
<span class="hljs-bullet">-</span> 引入依赖
<span class="hljs-bullet">-</span> 编写配置</code></pre>

<pre><code class="hljs xml"><span class="hljs-comment">&lt;!--引入jwt--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.auth0<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>java-jwt<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-comment">&lt;!--引入mybatis--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-comment">&lt;!--引入lombok--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-comment">&lt;!--引入druid--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.19<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-comment">&lt;!--引入mysql--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.38<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>

<pre><code class="hljs properties"><span class="hljs-meta">server.port</span>=<span class="hljs-string">8989</span>
<span class="hljs-meta">spring.application.name</span>=<span class="hljs-string">jwt</span>

<span class="hljs-meta">spring.datasource.type</span>=<span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span>
<span class="hljs-meta">spring.datasource.driver-class-name</span>=<span class="hljs-string">com.mysql.jdbc.Driver</span>
<span class="hljs-meta">spring.datasource.url</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/jwt?characterEncoding=UTF-8</span>
<span class="hljs-meta">spring.datasource.username</span>=<span class="hljs-string">root</span>
<span class="hljs-meta">spring.datasource.password</span>=<span class="hljs-string">root</span>

<span class="hljs-meta">mybatis.type-aliases-package</span>=<span class="hljs-string">com.baizhi.entity</span>
<span class="hljs-meta">mybatis.mapper-locations</span>=<span class="hljs-string">classpath:com/baizhi/mapper/*.xml</span>

<span class="hljs-meta">logging.level.com.baizhi.dao</span>=<span class="hljs-string">debug</span></code></pre>

<pre><code class="hljs markdown"><span class="hljs-section"># 1.开发数据库</span>
<span class="hljs-bullet">-</span> 这里采用最简单的表结构验证JWT使用</code></pre>

<p><img src="https://pic.downk.cc/item/5ff6b0473ffa7d37b3175f78.png" srcset="/img/loading.gif" alt="image-20200805212226422"></p>
<pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">`user`</span>;
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`user`</span> (
  <span class="hljs-string">`id`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;主键&#x27;</span>,
  <span class="hljs-string">`name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">80</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;用户名&#x27;</span>,
  <span class="hljs-string">`password`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">40</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;用户密码&#x27;</span>,
  PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`id`</span>)
) <span class="hljs-keyword">ENGINE</span>=<span class="hljs-keyword">InnoDB</span> AUTO_INCREMENT=<span class="hljs-number">2</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CHARSET</span>=utf8;</code></pre>

<pre><code class="hljs markdown"><span class="hljs-section"># 2.开发entity</span></code></pre>

<pre><code class="hljs java"><span class="hljs-meta">@Data</span>
<span class="hljs-meta">@Accessors(chain=true)</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;
    <span class="hljs-keyword">private</span> String id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> String password;
&#125;</code></pre>

<p><img src="https://pic.downk.cc/item/5ff6b0473ffa7d37b3175f7b.png" srcset="/img/loading.gif" alt="image-20200805213539471"></p>
<pre><code class="hljs markdown"><span class="hljs-section"># 3.开发DAO接口和mapper.xml</span></code></pre>

<pre><code class="hljs java"><span class="hljs-meta">@Mapper</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserDAO</span> </span>&#123;
    <span class="hljs-function">User <span class="hljs-title">login</span><span class="hljs-params">(User user)</span></span>;
&#125;</code></pre>

<p><img src="https://pic.downk.cc/item/5ff6b0473ffa7d37b3175f7d.png" srcset="/img/loading.gif" alt="image-20200805213603655"></p>
<pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.baizhi.dao.UserDAO&quot;</span>&gt;</span>
    <span class="hljs-comment">&lt;!--这里就写的简单点了毕竟不是重点--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;login&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;User&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;User&quot;</span>&gt;</span>
        select * from user where name=#&#123;name&#125; and password = #&#123;password&#125;
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre>

<p><img src="https://pic.downk.cc/item/5ff6b0463ffa7d37b3175f33.png" srcset="/img/loading.gif" alt="image-20200805213628252"></p>
<pre><code class="hljs markdown"><span class="hljs-section"># 4.开发Service 接口以及实现类</span></code></pre>

<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserService</span> </span>&#123;
    <span class="hljs-function">User <span class="hljs-title">login</span><span class="hljs-params">(User user)</span></span>;<span class="hljs-comment">//登录接口</span>
&#125;</code></pre>

<p><img src="https://pic.downk.cc/item/5ff6b0463ffa7d37b3175f36.png" srcset="/img/loading.gif" alt="image-20200805213648147"></p>
<pre><code class="hljs java"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserDAO userDAO;
    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@Transactional(propagation = Propagation.SUPPORTS)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">login</span><span class="hljs-params">(User user)</span> </span>&#123;
        User userDB = userDAO.login(user);
        <span class="hljs-keyword">if</span>(userDB!=<span class="hljs-keyword">null</span>)&#123;
            <span class="hljs-keyword">return</span> userDB;
        &#125;
        <span class="hljs-keyword">throw</span>  <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;登录失败~~&quot;</span>);
    &#125;
&#125;</code></pre>

<p><img src="https://pic.downk.cc/item/5ff6b0463ffa7d37b3175f3b.png" srcset="/img/loading.gif" alt="image-20200805213704965"></p>
<pre><code class="hljs markdown"><span class="hljs-section"># 5.开发controller</span></code></pre>

<pre><code class="hljs java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;
    <span class="hljs-meta">@GetMapping(&quot;/user/login&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String,Object&gt; <span class="hljs-title">login</span><span class="hljs-params">(User user)</span> </span>&#123;
        Map&lt;String,Object&gt; result = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
        log.info(<span class="hljs-string">&quot;用户名: [&#123;&#125;]&quot;</span>, user.getName());
        log.info(<span class="hljs-string">&quot;密码: [&#123;&#125;]&quot;</span>, user.getPassword());
        <span class="hljs-keyword">try</span> &#123;
            User userDB = userService.login(user);
            Map&lt;String, String&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<span class="hljs-comment">//用来存放payload</span>
            map.put(<span class="hljs-string">&quot;id&quot;</span>,userDB.getId());
            map.put(<span class="hljs-string">&quot;username&quot;</span>, userDB.getName());
            String token = JWTUtils.getToken(map);
            result.put(<span class="hljs-string">&quot;state&quot;</span>,<span class="hljs-keyword">true</span>);
            result.put(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;登录成功!!!&quot;</span>);
            result.put(<span class="hljs-string">&quot;token&quot;</span>,token); <span class="hljs-comment">//成功返回token信息</span>
        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
            e.printStackTrace();
            result.put(<span class="hljs-string">&quot;state&quot;</span>,<span class="hljs-string">&quot;false&quot;</span>);
            result.put(<span class="hljs-string">&quot;msg&quot;</span>,e.getMessage());
        &#125;
        <span class="hljs-keyword">return</span> result;
    &#125;
&#125;</code></pre>

<p><img src="https://pic.downk.cc/item/5ff6b0463ffa7d37b3175f40.png" srcset="/img/loading.gif" alt="image-20200805214235426"></p>
<pre><code class="hljs markdown"><span class="hljs-section"># 6.数据库添加测试数据启动项目</span></code></pre>

<p><img src="https://pic.downk.cc/item/5ff6b0463ffa7d37b3175f44.png" srcset="/img/loading.gif" alt="image-20200805214324868"></p>
<p><img src="https://pic.downk.cc/item/5ff6b0463ffa7d37b3175f49.png" srcset="/img/loading.gif" alt="image-20200805214424786"></p>
<pre><code class="hljs markdown"><span class="hljs-section"># 7.通过postman模拟登录失败</span></code></pre>

<p><img src="https://pic.downk.cc/item/5ff6b0473ffa7d37b3175f4d.png" srcset="/img/loading.gif" alt="image-20200805214610668"></p>
<pre><code class="hljs markdown"><span class="hljs-section"># 8.通过postman模拟登录成功</span></code></pre>

<p><img src="https://pic.downk.cc/item/5ff6b0473ffa7d37b3175f53.png" srcset="/img/loading.gif" alt="image-20200805214749469"></p>
<pre><code class="hljs markdown"><span class="hljs-section"># 9.编写测试接口</span></code></pre>

<pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/test/test&quot;)</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title">test</span><span class="hljs-params">(String token)</span> </span>&#123;
  Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
  <span class="hljs-keyword">try</span> &#123;
    JWTUtils.verify(token);
    map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;验证通过~~~&quot;</span>);
    map.put(<span class="hljs-string">&quot;state&quot;</span>, <span class="hljs-keyword">true</span>);
  &#125; <span class="hljs-keyword">catch</span> (TokenExpiredException e) &#123;
    map.put(<span class="hljs-string">&quot;state&quot;</span>, <span class="hljs-keyword">false</span>);
    map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;Token已经过期!!!&quot;</span>);
  &#125; <span class="hljs-keyword">catch</span> (SignatureVerificationException e)&#123;
    map.put(<span class="hljs-string">&quot;state&quot;</span>, <span class="hljs-keyword">false</span>);
    map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;签名错误!!!&quot;</span>);
  &#125; <span class="hljs-keyword">catch</span> (AlgorithmMismatchException e)&#123;
    map.put(<span class="hljs-string">&quot;state&quot;</span>, <span class="hljs-keyword">false</span>);
    map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;加密算法不匹配!!!&quot;</span>);
  &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
    e.printStackTrace();
    map.put(<span class="hljs-string">&quot;state&quot;</span>, <span class="hljs-keyword">false</span>);
    map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;无效token~~&quot;</span>);
  &#125;
  <span class="hljs-keyword">return</span> map;
&#125;</code></pre>

<p><img src="https://pic.downk.cc/item/5ff6b0473ffa7d37b3175f56.png" srcset="/img/loading.gif" alt="image-20200805215119590"></p>
<pre><code class="hljs markdown"><span class="hljs-section"># 10.通过postman请求接口</span></code></pre>

<p><img src="https://pic.downk.cc/item/5ff6b0473ffa7d37b3175f58.png" srcset="/img/loading.gif" alt="image-20200805215337303"></p>
<p><img src="https://pic.downk.cc/item/5ff6b0473ffa7d37b3175f5d.png" srcset="/img/loading.gif" alt="image-20200805215451442"></p>
<pre><code class="hljs markdown"><span class="hljs-section"># 11.问题?</span>
<span class="hljs-bullet">-</span> 使用上述方式每次都要传递token数据,每个方法都需要验证token代码冗余,不够灵活? 如何优化
<span class="hljs-bullet">-</span> 使用拦截器进行优化</code></pre>

<pre><code class="hljs java"><span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
  String token = request.getHeader(<span class="hljs-string">&quot;token&quot;</span>);
  Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
  <span class="hljs-keyword">try</span> &#123;
    JWTUtils.verify(token);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
  &#125; <span class="hljs-keyword">catch</span> (TokenExpiredException e) &#123;
    map.put(<span class="hljs-string">&quot;state&quot;</span>, <span class="hljs-keyword">false</span>);
    map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;Token已经过期!!!&quot;</span>);
  &#125; <span class="hljs-keyword">catch</span> (SignatureVerificationException e)&#123;
    map.put(<span class="hljs-string">&quot;state&quot;</span>, <span class="hljs-keyword">false</span>);
    map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;签名错误!!!&quot;</span>);
  &#125; <span class="hljs-keyword">catch</span> (AlgorithmMismatchException e)&#123;
    map.put(<span class="hljs-string">&quot;state&quot;</span>, <span class="hljs-keyword">false</span>);
    map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;加密算法不匹配!!!&quot;</span>);
  &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
    e.printStackTrace();
    map.put(<span class="hljs-string">&quot;state&quot;</span>, <span class="hljs-keyword">false</span>);
    map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;无效token~~&quot;</span>);
  &#125;
  String json = <span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(map);
  response.setContentType(<span class="hljs-string">&quot;application/json;charset=UTF-8&quot;</span>);
  response.getWriter().println(json);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
&#125;</code></pre>

<pre><code class="hljs java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">InterceptorConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>&#123;
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> </span>&#123;
        registry.addInterceptor(<span class="hljs-keyword">new</span> JwtTokenInterceptor()).
          excludePathPatterns(<span class="hljs-string">&quot;/user/**&quot;</span>)
          .addPathPatterns(<span class="hljs-string">&quot;/**&quot;</span>);
    &#125;
&#125;</code></pre>


            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/01/07/ElasticSearch/">
                        <span class="hidden-mobile">ElasticSearch</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
    

    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>







  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '#post-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "JWT实战&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>




















</body>
</html>
